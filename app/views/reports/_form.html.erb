<%= form_for(@report) do |f| %>
  <% if @report.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@report.errors.count, "error") %> prohibited this report from being saved:</h2>

      <ul>
      <% @report.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :generated_at %><br>
    <%= f.datetime_select :generated_at %>
  </div>

  <ul class='nav nav-tabs'>
    <li><a href='#'>Management</a></li>
    <li><a href='#'>Short report</a></li>
    <li class='active'><a href='#'>Detailed report</a></li>
  </ul>

  <table class='report table table-bordered'>
    <tr>
      <th>Project</th>
      <th>Task ID</th>
      <th>Task Desc</th>
      <th>Task Completion Date (per MS Project)</th>
      <th>Start date</th>
      <th>End date</th>
      <th>%</th>
      <th>ETA for completion</th>
      <th>Status</th>
    </tr>

    <% @report_entries.each do |user, rentry_array| %>

        <tr>
          <td colspan='11' class='active'><strong><%= link_to user.full_name, user, name: user.jira_name %></td>
        </tr>

        <% rentry_array.each do |rentry| %>

        <tr>
          <%= hidden_field_tag "report[report_entries_attributes][][user_id]", rentry.user_id %>
          <%= hidden_field_tag "report[report_entries_attributes][][id]", rentry.id %>
          <td class="editable"><p class='project'><%= text_area_tag "report[report_entries_attributes][][project]", rentry.project, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='task_id'><%= text_area_tag "report[report_entries_attributes][][task_id]", rentry.task_id, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='task_desc'><%= text_area_tag "report[report_entries_attributes][][task_desc]", rentry.task_desc, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='task_completion_per_ms_project'><%= text_area_tag "report[report_entries_attributes][][msproject_task_completion_date]", rentry.msproject_task_completion_date, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='start_date'><%= text_area_tag "report[report_entries_attributes][][started_at]", rentry.started_at, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='end_date'><%= text_area_tag "report[report_entries_attributes][][ended_at]", rentry.ended_at, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='percentage'><%= text_area_tag "report[report_entries_attributes][][percentage]", rentry.percentage, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='eta'><%= text_area_tag "report[report_entries_attributes][][eta]", rentry.eta, class: 'form-control project', spellcheck:false %></p></td>
          <td class="editable"><p class='status'><%= text_area_tag "report[report_entries_attributes][][status]", rentry.status, class: 'form-control project', spellcheck:false %></p></td>
        </tr>
            <tr>
              <td colspan='2'></td>
              <td colspan='2' class='editable'>
                <%= text_area_tag "report[report_entries_attributes][][issues]", rentry.issues, rows: 3, class: 'form-control project', spellcheck:false %>
              </td>
              <td colspan='5' class='editable'>
                <%= text_area_tag "report[report_entries_attributes][][risk_mitigation_plans]", rentry.risk_mitigation_plans, rows: 3, class: 'form-control project', spellcheck:false %>
              </td>
        </tr>
        <% end %>
    <% end %>
  </table>

    <div class="actions">
      <%= f.submit %>
    </div>
<% end %>